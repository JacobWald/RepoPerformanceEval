{% load static %}
<link rel="stylesheet" href="{% static 'styles/dashboard_dev.css' %}" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<section>
  <div
    id="developer-panel"
    class="developer-panel"
    data-json-url="{{ analysis.json_url }}"
  >
    <div class="dev-dropdown-wrapper">
      <div class="dev-dropdown" id="dev-dropdown">
        <button
          type="button"
          class="dev-dropdown-toggle"
          id="dev-dropdown-toggle"
        >
          <span id="dev-dropdown-label">Select developer</span>
          <span class="dev-dropdown-arrow">▾</span>
        </button>

        <div class="dev-dropdown-menu" id="dev-dropdown-menu">
          <input
            type="text"
            id="dev-dropdown-search"
            class="dev-dropdown-search"
            placeholder="Search by name or email..."
          />
          <ul class="dev-dropdown-list" id="dev-dropdown-list">
            <!-- <li> items inserted by JS -->
          </ul>
        </div>
      </div>
    </div>
    <div class="dev-insights-heading">
      <h2 class="activity-card-title" id="dev-insights-title">
        Developer Insights
      </h2>
      <p class="dev-insights-subtitle" id="dev-insights-subtitle">
        Select a developer from the dropdown to see per-developer statistics.
      </p>
    </div>
    <div class="activity-card">
      <!-- Stats grid (cards) on the same purple background -->
      <div class="dev-stats-grid">
        <!-- Commits & lines -->
        <div class="dev-stat-tile">
          <div class="dev-stat-icon">
            <img
              src="{% static 'icons/commits.svg' %}"
              alt="Commits icon"
              class="dev-stat-icon-img"
            />
          </div>
          <div class="dev-stat-text">
            <div class="dev-stat-label">Commits &amp; Lines</div>
            <div class="dev-stat-value" data-dev-stat="commits">–</div>
            <div class="dev-stat-subvalue" data-dev-stat="lines">–</div>
          </div>
        </div>

        <!-- Average streak -->
        <div class="dev-stat-tile">
          <div class="dev-stat-icon">
            <img
              src="{% static 'icons/lines_added.svg' %}"
              alt="Streak icon"
              class="dev-stat-icon-img"
            />
          </div>
          <div class="dev-stat-text">
            <div class="dev-stat-label">Average streak</div>
            <div class="dev-stat-value" data-dev-stat="streak">–</div>
            <div class="dev-stat-subvalue">days</div>
          </div>
        </div>

        <!-- Most active time -->
        <div class="dev-stat-tile">
          <div class="dev-stat-icon">
            <img
              src="{% static 'icons/lines_added.svg' %}"
              alt="Active time icon"
              class="dev-stat-icon-img"
            />
          </div>
          <div class="dev-stat-text">
            <div class="dev-stat-label">Most active time</div>
            <div class="dev-stat-value" data-dev-stat="active-day">–</div>
            <div class="dev-stat-subvalue" data-dev-stat="active-hour">–</div>
          </div>
        </div>

        <!-- CI failures -->
        <div class="dev-stat-tile">
          <div class="dev-stat-icon">
            <img
              src="{% static 'icons/failed_builds.svg' %}"
              alt="CI failures icon"
              class="dev-stat-icon-img"
            />
          </div>
          <div class="dev-stat-text">
            <div class="dev-stat-label">CI failures</div>
            <div class="dev-stat-value" data-dev-stat="ci-failure-ratio">–</div>
            <div class="dev-stat-subvalue" data-dev-stat="ci-runs">–</div>
          </div>
        </div>

        <div class="dev-stat-tile">
          <div class="dev-stat-icon">
            <!-- TODO: use a specific icon if you add one -->
            <img
              src="{% static 'icons/commits.svg' %}"
              alt="Last commit icon"
              class="dev-stat-icon-img"
            />
          </div>
          <div class="dev-stat-text">
            <div class="dev-stat-label">Last commit</div>
            <!-- e.g. "5 days ago", "today" -->
            <div class="dev-stat-value" data-dev-stat="last-active">–</div>
            <!-- e.g. "on 2025-11-10" -->
            <div class="dev-stat-subvalue" data-dev-stat="last-active-date">
              –
            </div>
          </div>
        </div>

        <!-- NEW TILE: Activity window (active days) -->
        <div class="dev-stat-tile">
          <div class="dev-stat-icon">
            <img
              src="{% static 'icons/lines_added.svg' %}"
              alt="Activity window icon"
              class="dev-stat-icon-img"
            />
          </div>
          <div class="dev-stat-text">
            <div class="dev-stat-label">Activity in window</div>
            <!-- e.g. "20 of 45 days" -->
            <div class="dev-stat-value" data-dev-stat="active-days">–</div>
            <!-- e.g. "Window: 45 days" -->
            <div class="dev-stat-subvalue" data-dev-stat="window-length">–</div>
          </div>
        </div>

        <!-- NEW TILE: Weekend activity -->
        <div class="dev-stat-tile">
          <div class="dev-stat-icon">
            <img
              src="{% static 'icons/lines_added.svg' %}"
              alt="Weekend activity icon"
              class="dev-stat-icon-img"
            />
          </div>
          <div class="dev-stat-text">
            <div class="dev-stat-label">Weekend activity</div>
            <!-- e.g. "18.3% of commits" -->
            <div class="dev-stat-value" data-dev-stat="weekend-share">–</div>
            <!-- e.g. "12 weekend commits" -->
            <div class="dev-stat-subvalue" data-dev-stat="weekend-count">–</div>
          </div>
        </div>
      </div>
    </div>
    <div class="small-activity-card">
        <!--graph -->
        <div class="ci-bar-chart-container">
          <canvas id="ciBarChart" width="400" height="200"></canvas>
        </div>
    </div>
    <div class="activity-card">
        <!--expanldable table listing-->
        <table id="commitTable" class="commit-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Time</th>
              <th>Commit Message</th>
              <th>CI Result</th>
              <th>Lines +/-</th>
              <th>Link</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="commitTableBody"></tbody>
        </table>
    </div>
    </div>
    </div>
  </div>
</section>
