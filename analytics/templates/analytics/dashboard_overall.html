{% load static %}
<link rel="stylesheet" href="{% static 'styles/dashboard_overall.css' %}">

<h2 class="tab-title">Analytics for <strong>{{ repo.name }}</strong></h2>

<section class="activity-card">
  <h2 class="activity-card-title">
    Project Activity (Last <span id="activity-days-window">—</span> Days)
  </h2>

  <div id="activity-bar"
       class="activity-bar"
       data-json-url="{{ analysis.json_url }}">

    <div class="activity-bar-legend">
      <!-- Commits -->
      <div class="legend-tile">
        <div class="legend-icon">
          <!-- TODO: replace src with your real icon file -->
          <img src="{% static 'icons/commits.svg' %}" alt="Commits icon" class="legend-icon-img">
        </div>
        <div class="legend-text">
          <div class="legend-label">Commits</div>
          <div class="legend-value" data-stat="commits">–</div>
        </div>
      </div>

      <!-- Commits with CI -->
      <div class="legend-tile">
        <div class="legend-icon">
          <img src="{% static 'icons/commits_ci.svg' %}" alt="Commits with CI icon" class="legend-icon-img">
        </div>
        <div class="legend-text">
          <div class="legend-label">Commits with CI</div>
          <div class="legend-value" data-stat="commits-ci">–</div>
        </div>
      </div>

      <!-- Lines added -->
      <div class="legend-tile">
        <div class="legend-icon">
          <img src="{% static 'icons/lines_added.svg' %}" alt="Lines added icon" class="legend-icon-img">
        </div>
        <div class="legend-text">
          <div class="legend-label">Lines added</div>
          <div class="legend-value" data-stat="lines-added">–</div>
        </div>
      </div>

      <!-- Lines deleted -->
      <div class="legend-tile">
        <div class="legend-icon">
          <img src="{% static 'icons/lines_deleted.svg' %}" alt="Lines deleted icon" class="legend-icon-img">
        </div>
        <div class="legend-text">
          <div class="legend-label">Lines deleted</div>
          <div class="legend-value" data-stat="lines-deleted">–</div>
        </div>
      </div>

      <!-- CI runs -->
      <div class="legend-tile">
        <div class="legend-icon">
          <img src="{% static 'icons/ci_runs.svg' %}" alt="CI runs icon" class="legend-icon-img">
        </div>
        <div class="legend-text">
          <div class="legend-label">CI runs</div>
          <div class="legend-value" data-stat="ci-runs">–</div>
        </div>
      </div>

      <!-- Failed builds -->
      <div class="legend-tile">
        <div class="legend-icon">
          <img src="{% static 'icons/failed_builds.svg' %}" alt="Failed builds icon" class="legend-icon-img">
        </div>
        <div class="legend-text">
          <div class="legend-label">Failed builds</div>
          <div class="legend-value" data-stat="ci-failure">–</div>
        </div>
      </div>

      <!-- PR success rate -->
      <div class="legend-tile">
        <div class="legend-icon">
          <img src="{% static 'icons/pr_success.svg' %}" alt="PR success icon" class="legend-icon-img">
        </div>
        <div class="legend-text">
          <div class="legend-label">PR success rate</div>
          <div class="legend-value" data-stat="pr-success">–</div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="ci-card">
  <h2 class="ci-card-title">CI Reliability</h2>
  <p class="ci-card-subtitle">
    How stable your CI has been over the analysis window.
  </p>

  <div class="ci-charts-grid">
    <div class="ci-chart">
      <h3 class="ci-chart-title">Weekly CI success vs failure</h3>
      <canvas id="ci-weekly-chart"></canvas>
    </div>

    <div class="ci-chart">
      <h3 class="ci-chart-title">Weekly commits vs failed CI runs</h3>
      <canvas id="ci-weekly-commits-chart"></canvas>
    </div>
  </div>
</section>

<section class="ci-card">
  <h2 class="ci-card-title">Commit Type Breakdown</h2>
  <p class="ci-card-subtitle">
    Categorized from commit messages: bug fixes, refactors, features, and other changes.
  </p>

  <div class="ci-charts-grid">
    <div class="ci-chart">
      <h3 class="ci-chart-title">Bug fixes vs refactors vs features</h3>
      <canvas id="commit-type-pie"></canvas>
    </div>
  </div>
</section>

<section class="ci-card"></section>
  <h2 class="ci-card-title">Commit Time Distribution</h2>
  <p class="ci-card-subtitle">
    How commits are spread across the day, and who is committing at each time.
  </p>

  <div class="ci-charts-grid">
    <div class="ci-chart">
      <h3 class="ci-chart-title">Commits by time window</h3>
      <canvas id="commit-hours-bar"></canvas>

      <div id="commit-hours-details" class="commit-hours-details">
        <p class="commit-hours-hint">
          Click a bar to see which developers commit in that time window.
        </p>
        <p class="commit-hours-selected" id="commit-hours-selected">
          No time window selected yet.
        </p>
        <table class="commit-hours-table">
          <thead>
            <tr>
              <th>Developer</th>
              <th>Email</th>
              <th>Commits in window</th>
            </tr>
          </thead>
          <tbody id="commit-hours-dev-tbody">
            <!-- rows inserted by JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
